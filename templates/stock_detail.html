{% extends 'layout.html' %}

{% block content %}
<style>
    body {
        background-color: #1b1c1d;
        color: white;
    }
</style>

<div class="ui inverted segment" style="background-color: #1b1c1d; color: white; padding: 20px;">
    <h1>
        <a href="/" style="color: cyan;">Stocks</a>
        <i class="angle double right icon"></i>
        {{ stock.name }} ({{ stock.symbol }})
    </h1>

    <!-- TradingView Widget BEGIN -->
    <div class="tradingview-widget-container" style="margin-top: 20px;">
        <div class="tradingview-widget-container__widget"></div>
        <div class="tradingview-widget-copyright">
            <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
                <span class="blue-text">Track all markets on TradingView</span>
            </a>
        </div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
        {
            "width": "100%",
            "height": "610",
            "symbol": "{{ stock.exchange }}:{{ stock.symbol }}",
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "dark",
            "style": "2",
            "locale": "en",
            "allow_symbol_change": true,
            "hide_side_toolbar": false
        }
        </script>
    </div>
    <!-- TradingView Widget END -->


    <form action="/buy_stock/{{ stock.symbol }}" method="POST">
        <label for="quantity">Enter stock quantity:</label>
        <input type="number" id="quantity" name="quantity" value="" min="1" required><br>
        <label for="price">Price to buy:</label>
        <input type="text" id="price" name="price" value="" disabled><br>
        <input type="submit" value="Buy Stock">
    </form>

    <h2 style="margin-top: 20px;">Prices</h2>
    <table class="ui selectable inverted table" style="background-color: #333; color: white;">
        <thead>
            <tr>
                <th>Date</th>
                <th>Open</th>
                <th>High</th>
                <th>Low</th>
                <th>Close</th>
                <th>Volume</th>
            </tr>
        </thead>
        <tbody>
            {% for bar in bars %}
            <tr>
                <td>{{ bar.date }}</td>
                <td>{{ bar.open }}</td>
                <td>{{ bar.high }}</td>
                <td>{{ bar.low }}</td>
                <td>{{ bar.close }}</td>
                <td>{{ bar.volume }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    // have jinja give closing price of last data point (soonest data point)
    let stock_price = {{ last_bar.close }};
    document.getElementById("quantity").addEventListener("input", function() {
        // modify price field by calculating price (and round it to 3 digits)
        document.getElementById("price").value = parseFloat((document.getElementById("quantity").value * stock_price).toFixed(3));
    });
</script>


{% endblock %}
