{% extends 'layout.html' %}

{% block title %}{{ stock.name }} Details{% endblock %}

{% block content %}
<style>
    .buy-stock-form {
        width: 100%;
        background-color: #222;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        margin-top: 20px;
    }
    .buy-stock-form label, .buy-stock-form input {
        display: block;
        margin-bottom: 10px;
        color: white;
    }
    .buy-stock-form input[type="number"], .buy-stock-form input[type="text"] {
        width: 100%;
        padding: 10px;
        border: none;
        background-color: #333;
        color: white;
        border-radius: 5px;
    }
    .buy-stock-form input[type="submit"] {
        background-color: #21ba45;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .buy-stock-form input[type="submit"]:hover {
        background-color: #16ab39;
    }
</style>

<h1>
    <a href="/" style="color: cyan;">Stocks</a>
    <i class="angle double right icon"></i>
    {{ stock.name }} ({{ stock.symbol }})
</h1>

<!-- TradingView Widget -->
<div class="tradingview-widget-container" style="margin-top: 20px;">
    <div class="tradingview-widget-container__widget"></div>
    <div class="tradingview-widget-copyright">
        <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
            <span class="blue-text">Track all markets on TradingView</span>
        </a>
    </div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
    {
        "width": "100%",
        "height": "610",
        "symbol": "{{ stock.exchange }}:{{ stock.symbol }}",
        "interval": "D",
        "timezone": "Etc/UTC",
        "theme": "dark",
        "style": "2",
        "locale": "en",
        "allow_symbol_change": true,
        "hide_side_toolbar": false
    }
    </script>
</div>

<!-- Buy Stock Form -->
<div class="buy-stock-form">
    <h2 style="color: white;">Buy Stock</h2>
    <form action="/buy_stock/{{ stock.symbol }}" method="POST">
        <label for="quantity">Enter Stock Quantity:</label>
        <input type="number" id="quantity" name="quantity" min="1" required>

        <label for="price">Total Price:</label>
        <input type="text" id="price" name="price" disabled>

        <input type="submit" value="Buy Stock">
    </form>
</div>


<!-- Stock Data Table -->
<h2 style="margin-top: 40px;">Prices</h2>
    <table class="ui selectable inverted table" style="background-color: #333; color: white;">
        <thead>
            <tr>
                <th>Date</th>
                <th>Open</th>
                <th>High</th>
                <th>Low</th>
                <th>Close</th>
                <th>Volume</th>
            </tr>
        </thead>
        <tbody>
            {% for bar in bars %}
            <tr>
                <td>{{ bar.date }}</td>
                <td>{{ bar.open }}</td>
                <td>{{ bar.high }}</td>
                <td>{{ bar.low }}</td>
                <td>{{ bar.close }}</td>
                <td>{{ bar.volume }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        let stock_price = {{ last_bar.close }};
        document.getElementById("quantity").addEventListener("input", function() {
            document.getElementById("price").value = parseFloat((document.getElementById("quantity").value * stock_price).toFixed(3));
        });
    </script>
{% endblock %}
